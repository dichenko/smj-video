# Инструкция по настройке Google Sheets API

Для интеграции бота с Google Sheets необходимо выполнить следующие шаги:

## 1. Создание проекта в Google Cloud Console

1. Перейдите на [Google Cloud Console](https://console.cloud.google.com/)
2. Нажмите на выпадающее меню в верхней панели и выберите "Новый проект"
3. Введите название проекта (например, "SMJ Video Bot")
4. Нажмите "Создать"
5. Дождитесь создания проекта и переключитесь на него

## 2. Включение Google Sheets API

1. В боковом меню выберите "APIs и сервисы" -> "Библиотека"
2. В поиске введите "Google Sheets API"
3. Выберите "Google Sheets API" из результатов поиска
4. Нажмите кнопку "Включить"

## 3. Создание сервисного аккаунта

1. В боковом меню выберите "APIs и сервисы" -> "Учетные данные"
2. Нажмите "Создать учетные данные" и выберите "Сервисный аккаунт"
3. Введите имя сервисного аккаунта (например, "smj-video-bot")
4. Добавьте описание (например, "Сервисный аккаунт для бота видеоотчетов")
5. Нажмите "Создать и продолжить"
6. В разделе "Предоставление этому сервисному аккаунту доступ к проекту" выберите роль "Редактор" (или более специфичную роль, если требуется)
7. Нажмите "Готово"

## 4. Создание ключа для сервисного аккаунта

1. В списке сервисных аккаунтов найдите только что созданный аккаунт
2. Нажмите на три точки в конце строки (в столбце "Действия")
3. Выберите "Управление ключами"
4. Нажмите "Добавить ключ" -> "Создать новый ключ"
5. Выберите тип ключа "JSON"
6. Нажмите "Создать"
7. Файл с ключом автоматически загрузится на ваш компьютер
8. **Сохраните этот файл в надежном месте** - он содержит конфиденциальную информацию

## 5. Создание Google Таблицы

1. Перейдите на [Google Sheets](https://sheets.google.com/)
2. Создайте новую таблицу
3. Переименуйте первый лист на "Отчеты"
4. В адресной строке браузера найдите ID таблицы. Это часть URL между `/d/` и `/edit` например:
   ```
   https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID/edit
   ```
5. Скопируйте этот ID - он потребуется для настройки бота

## 6. Предоставление доступа сервисному аккаунту

1. В открытой таблице нажмите кнопку "Поделиться" в правом верхнем углу
2. В поле "Добавить пользователей и группы" введите email сервисного аккаунта (он находится в файле JSON, который вы скачали, поле `client_email`)
3. Выберите роль "Редактор"
4. Уберите галочку "Уведомить людей"
5. Нажмите "Поделиться"

## 7. Настройка переменных окружения для бота

После получения всех необходимых данных, добавьте их в файл `.env.local`:

```
GOOGLE_SHEET_ID=your_spreadsheet_id
GOOGLE_CLIENT_EMAIL=your_service_account_email
GOOGLE_PRIVATE_KEY="your_private_key_from_json_file"
```

Обратите внимание:
- Для переменной `GOOGLE_PRIVATE_KEY` скопируйте значение из файла JSON (поле `private_key`), включая кавычки
- Если в ключе есть символы перевода строки (`\n`), оставьте их как есть
- Весь ключ должен быть заключен в двойные кавычки

## Проверка работоспособности

После настройки всех переменных окружения и запуска бота, система должна автоматически инициализировать Google Таблицу при первом запуске, добавив заголовки столбцов.

Если вы столкнулись с проблемами:
1. Проверьте, что сервисный аккаунт имеет доступ к таблице
2. Убедитесь, что ID таблицы указан правильно
3. Проверьте формат приватного ключа (включая наличие символов `\n`) 